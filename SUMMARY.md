# üì¶ Gateway Proxy - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

## ‚úÖ –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

### 1. **–ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å** (`proxy.py`)
–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–≤—è–∑–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —à–ª—é–∑–∞ —Å –æ–±–ª–∞—á–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–æ–º.

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –æ–±–ª–∞–∫–æ–º
- ‚úÖ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ WS ‚Üí HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ Ping/pong heartbeat
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ Graceful shutdown

### 2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- `.env.example` - –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `.env` - —Ä–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ)

### 3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
- `README.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º
- `INSTALLATION_GUIDE.md` - –ø–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ production
- `QUICK_START.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
- `SUMMARY.md` (—ç—Ç–æ—Ç —Ñ–∞–π–ª) - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

### 4. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**
- `start_proxy.sh` - —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –¥–ª—è Linux/macOS
- `requirements.txt` - Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- Systemd service —Ñ–∞–π–ª (–æ–ø–∏—Å–∞–Ω –≤ INSTALLATION_GUIDE.md)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Cloud Server      ‚îÇ  wss://railway.app
‚îÇ   (Railway)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ WebSocket
           ‚îÇ (JWT auth)
           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Gateway Proxy      ‚îÇ  /opt/gateway_proxy
‚îÇ  (This service)     ‚îÇ  ‚Ä¢ –ü–æ–ª—É—á–∞–µ—Ç WS —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ                     ‚îÇ  ‚Ä¢ –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ HTTP
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚Ä¢ –õ–æ–≥–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏
           ‚îÇ HTTP POST
           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Payment Gateway     ‚îÇ  http://localhost:8080
‚îÇ (Local)             ‚îÇ  ‚Ä¢ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏
‚îÇ                     ‚îÇ  ‚Ä¢ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

### –û—Ç –æ–±–ª–∞–∫–∞ –∫ –ø—Ä–æ–∫—Å–∏ (WebSocket):
```json
{
  "type": "payment_request",
  "data": {
    "request_id": "REQ_ABC123",
    "kiosk_id": "KIOSK_001",
    "order_id": 9999995,
    "sum": 150000
  }
}
```

### –û—Ç –ø—Ä–æ–∫—Å–∏ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —à–ª—é–∑—É (HTTP POST):
```json
POST http://localhost:8080/payment
{
  "kiosk_id": "kiosk_001",
  "order_id": 9999995,
  "sum": 150000
}
```

### –û—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —à–ª—é–∑–∞ –∫ –ø—Ä–æ–∫—Å–∏ (HTTP Response):
```json
{
  "status": "success",
  "sum": 150000,
  "currency": "RUB",
  "payment_method": "card"
}
```

### –û—Ç –ø—Ä–æ–∫—Å–∏ –∫ –æ–±–ª–∞–∫—É (WebSocket):
```json
{
  "type": "payment_response",
  "data": {
    "request_id": "REQ_ABC123",
    "status": "SUCCESS",
    "sum": 150000,
    "currency": "RUB",
    "payment_method": "card",
    "timestamp": "2025-10-01T12:00:00Z",
    "payment_data": { /* –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç —à–ª—é–∑–∞ */ }
  }
}
```

---

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω
```
Telegram –±–æ—Ç: /add_kiosk
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
cd /opt/gateway_proxy
cp .env.example .env
nano .env  # –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python3 proxy.py
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. `INSTALLATION_GUIDE.md`

---

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –¢–µ—Å—Ç –Ω–∞ —ç—Ç–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (–±–µ–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —à–ª—é–∑–∞)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–æ–∫—Å–∏ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ –æ–±–ª–∞—á–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç ping/pong —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —à–ª—é–∑—É –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å –æ—à–∏–±–∫—É (—à–ª—é–∑ –Ω–µ –∑–∞–ø—É—â–µ–Ω) - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!

**–õ–æ–≥:**
```
üöÄ Payment Gateway Proxy starting...
‚úÖ Connected to cloud server
üì° Connection status: connected
üì• Received from cloud: ping
üì§ Sent to cloud: pong
```

### üîÑ –¢–µ—Å—Ç –Ω–∞ production (—Å –ª–æ–∫–∞–ª—å–Ω—ã–º —à–ª—é–∑–æ–º)

–ö–æ–≥–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä —Å —Ä–∞–±–æ—Ç–∞—é—â–∏–º –ø–ª–∞—Ç–µ–∂–Ω—ã–º —à–ª—é–∑–æ–º:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–∫—Å–∏
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ (`/send_payment`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üì• Received from cloud: payment_request
üí≥ Processing payment request: REQ_ABC123
üì® Sending HTTP request to local gateway...
‚úÖ Local gateway response: success
üì§ Sent to cloud: payment_response
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
gateway_proxy/
‚îú‚îÄ‚îÄ proxy.py                    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–æ–∫—Å–∏ (14KB)
‚îú‚îÄ‚îÄ requirements.txt            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env.example               # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .env                       # –†–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
‚îú‚îÄ‚îÄ start_proxy.sh             # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ (Linux/macOS)
‚îÇ
‚îú‚îÄ‚îÄ README.md                  # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ INSTALLATION_GUIDE.md      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ production
‚îú‚îÄ‚îÄ QUICK_START.md             # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îî‚îÄ‚îÄ SUMMARY.md                 # –≠—Ç–∞ —Å–≤–æ–¥–∫–∞
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è:
```
‚îú‚îÄ‚îÄ venv/                      # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python
‚îî‚îÄ‚îÄ gateway_proxy_YYYYMMDD.log # –õ–æ–≥–∏ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ:
- Python 3.11+
- 50 MB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –ü–ª–∞—Ç–µ–∂–Ω—ã–π —à–ª—é–∑ –Ω–∞ localhost:8080

### Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
- `websockets>=12.0` - WebSocket –∫–ª–∏–µ–Ω—Ç
- `aiohttp>=3.9.0` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
- `python-dotenv>=1.0.0` - –ó–∞–≥—Ä—É–∑–∫–∞ .env –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ):
1. ‚úÖ –ü—Ä–æ–∫—Å–∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É
2. ‚úÖ –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±–ª–∞–∫—É
3. ‚ö†Ô∏è HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ —à–ª—é–∑—É –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å (—à–ª—é–∑ –Ω–µ –∑–∞–ø—É—â–µ–Ω) - —ç—Ç–æ –û–ö

### –î–ª—è production (–Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å —à–ª—é–∑–æ–º):
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞–ø–∫—É `gateway_proxy/` –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –∫–æ–º–ø—å—é—Ç–µ—Ä
2. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `INSTALLATION_GUIDE.md`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ systemd service –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
4. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

---

## üìû –ü–æ–º–æ—â—å

- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** —Å–º. `QUICK_START.md`
- **–ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:** —Å–º. `INSTALLATION_GUIDE.md`
- **–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏:** —Å–º. `README.md`
- **–ü—Ä–æ–±–ª–µ–º—ã:** –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `gateway_proxy_YYYYMMDD.log`

---

## ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

- [x] –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±–ª–∞–∫—É - —É—Å–ø–µ—à–Ω–æ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
- [x] –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ production –∫–æ–º–ø—å—é—Ç–µ—Ä (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø–ª–∞—Ç–µ–∂–Ω—ã–º —à–ª—é–∑–æ–º

---

**üéâ –ü—Ä–æ–∫—Å–∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ production!**
